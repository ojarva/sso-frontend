{% extends "base.html" %}

{% block content %}
{% if enable_cookies %}
	<div class="alert alert-danger">
		Please enable cookies. You're not able to sign in without properly working cookies.
	</div>
{% endif %}


{% if message %}
<div class="alert alert-warning">
	{{ message }}
</div>
{% endif %}

{% if not user.strong_configured %}
<h2>Configure Strong Authentication</h2>

{% if back_url %}
<p><a href="{{ back_url }}" class="btn btn-info">Skip for now</a></p>
{% endif %}

<p>It appears you haven't configured strong authentication. 
{% if back_url %} If you want to, you can do this later. <a href="{{ back_url }}">Go back to service you tried to access</a>.{% endif %}
 This screen will be shown to you every time you login, until you select your preferences below.</p>

{% else %}
{% if back_url %}
<p><a href="{{ back_url }}" class="btn btn-info">Continue to service you tried to access</a></p>
{% endif %}
{% endif %}


{% if not user.strong_authenticator_secret %}

<p>You don't have Google Authenticator configured, or your configuration was revoked. Google Authenticator generates one-time passwords on your phone. That's faster and more reliable than receiving SMS messages.</p>

{% if not user.strong_sms_always %}
<p>If you want to, you can also opt for always receiving SMS message:</p>

<form name="loginform" method="POST" action="{% url 'login_frontend.views.configure_strong' %}?{{ get_params }}">
        {% csrf_token %}
        <input type="hidden" name="always_sms" value="on"><button class="btn btn-warning" type="submit">Always use SMS messages</button>
</form>
{% endif %}

<p>If you want to make your life a bit easier, you can

<form name="loginform" method="POST" action="{% url 'login_frontend.views.configure_authenticator' %}?{{ get_params }}">
        {% csrf_token %}
        <button class="btn btn-primary" type="submit">Configure Google Authenticator</button>
</form>

{% else %}

<p>You have Google Authenticator configured.</p>

<p>If you want to, you can opt to always use SMS messages instead:</p>

<form name="loginform" method="POST" action="{% url 'login_frontend.views.configure_strong' %}?{{ get_params }}">
        {% csrf_token %}
        <input type="hidden" name="always_sms" value="on"><button class="btn btn-warning" type="submit">Revoke and always use SMS messages</button>
</form>

<p>If you don't have Google Authenticator configured anymore - for example, after reinstalling or changing the phone - you can reconfigure it:</p>
<form name="loginform" method="POST" action="{% url 'login_frontend.views.configure_authenticator' %}?{{ get_params }}">
        {% csrf_token %}
        <button class="btn btn-primary" type="submit">Reconfigure Google Authenticator</button>
</form>




{% endif %}


<h2>Your active sessions:</h2>

<ul>
{% for detailed in sessions %}
<li>Seen<br>
   at <b>{{ detailed.session.last_seen }}</b>Â ({% if detailed.this_session %}this session{% else %}{{ detailed.session.last_seen|timesince}} ago{% endif %}) <br>
 from <b>{{ detailed.session.remote_ip }}</b> <br>
 with {{ detailed.browser.get_readable_ua}}
<form method="post" action="{% url 'login_frontend.views.configure_strong' %}?{{ get_params }}">
{% csrf_token %}
<input type="hidden" name="logout" value="{{ detailed.browser.bid_public }}">
<button type="submit" class="btn-sm btn btn-danger">logout</button>
</form>
</li>
{% endfor %}
</ul>

<h2>Your settings:</h2>
<ul>
<li>Primary phone number: {{ user.primary_phone }} (last changed: {{ user.primary_phone_refresh }})</li>
<li>Secondary phone number: {{ user.secondary_phone }} (last changed: {{ user.secondary_phone_refresh }})</li>
<li>Google Authenticator configured: {% if user.strong_authenticator_secret %}Yes, at {{ user.strong_authenticator_generated_at }}{% else %}No{% endif %}</li>
</ul>

{% endblock %}
